<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · GPUCellListSPH.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://PharmCat.github.io/GPUCellListSPH.jl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>GPUCellListSPH.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#First-step"><span>First step</span></a></li><li><a class="tocitem" href="#Principle-algorithm"><span>Principle algorithm</span></a></li><li><a class="tocitem" href="#Docs"><span>Docs</span></a></li><li><a class="tocitem" href="#Reference"><span>Reference</span></a></li></ul></li><li><a class="tocitem" href="details/">Details</a></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/main/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="GPUCellListSPH"><a class="docs-heading-anchor" href="#GPUCellListSPH">GPUCellListSPH</a><a id="GPUCellListSPH-1"></a><a class="docs-heading-anchor-permalink" href="#GPUCellListSPH" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>Smoothed-particle hydrodynamics (SPH) is a computational method used for simulating the mechanics of continuum media, such as solid mechanics and fluid flows. It was developed by Gingold and Monaghan and Lucy in 1977, initially for astrophysical problems. It has been used in many fields of research, including astrophysics, ballistics, volcanology, and oceanography. It is a meshfree Lagrangian method (where the co-ordinates move with the fluid), and the resolution of the method can easily be adjusted with respect to variables such as density. </p><p>Initially package was based on <a href="https://github.com/AhmedSalih3d">AhmedSalih3d</a> work (<a href="https://github.com/AhmedSalih3d/SPHExample">SPHExample</a>) and then taken new features.</p><p>See also <a href="https://ahmedsalih3d.github.io/SmoothedParticleHydrodynamicsManual/">Smoothed Particle Hydrodynamics Manual</a>.</p><p>Package working with CUDA.jl on GPU and not applicable for lunch on CPU. </p><div class="admonition is-info"><header class="admonition-header">Main goals</header><div class="admonition-body"><p>Main goal of this package - make clear and readable implementation of SPH. Performance wasn&#39;t primary goal of this package so desing and used algorithms for computation on GPU and memory organization coud be not so efficient.  </p></div></div><h2 id="First-step"><a class="docs-heading-anchor" href="#First-step">First step</a><a id="First-step-1"></a><a class="docs-heading-anchor-permalink" href="#First-step" title="Permalink"></a></h2><p>Simple example to try SPH:</p><pre><code class="language-julia hljs">
sing GPUCellListSPH
using CSV, DataFrames, CUDA, BenchmarkTools, SPHKernels

path = joinpath(dirname(pathof(GPUCellListSPH)))

fluid_csv    = joinpath(path, &quot;../test/input/FluidPoints_Dp0.02.csv&quot;)
boundary_csv = joinpath(path, &quot;../test/input/BoundaryPoints_Dp0.02.csv&quot;)

DF_POINTS = append!(CSV.File(fluid_csv) |&gt; DataFrame, CSV.File(boundary_csv) |&gt; DataFrame)
cpupoints = Tuple.(eachrow(DF_POINTS[!, [&quot;Points:0&quot;, &quot;Points:2&quot;]])) # Load particles 

dx  = 0.02                  # resolution
h   = 1.2 * sqrt(2) * dx    # smoothinl length
H   = 2h                    # kernel support length
h⁻¹ = 1/h
H⁻¹ = 1/H
dist = H                    # distance for neighborlist
ρ₀  = 1000.0                # reference dencity
m₀  = ρ₀ * dx * dx          # reference mass
α   = 0.01                  # Artificial viscosity constant
g   = 9.81                  # gravity
c₀  = sqrt(g * 2) * 20      # Speed of sound
γ   = 7                     # Gamma costant, used in the pressure equation of state
Δt  = dt  = 1e-5            # time step
δᵩ  = 0.1                   # Coefficient for density diffusion
CFL = 0.2                   # Courant–Friedrichs–Lewy condition for Δt stepping
cellsize = (H, H)           # cell size
sphkernel    = WendlandC2(Float64, 2) # SPH kernel from SPHKernels.jl

system  = GPUCellList(cpupoints, cellsize, dist)
N       = length(cpupoints)
ρ       = CUDA.zeros(Float64, N)
copyto!(ρ, DF_POINTS.Rhop)
ptype   = CUDA.zeros(Int32, N)
copyto!(ptype, DF_POINTS.ptype)
v       = CUDA.fill((0.0, 0.0), length(cpupoints))

sphprob =  SPHProblem(system, dx, h, H, sphkernel, ρ, v, ptype, ρ₀, m₀, Δt, α, g, c₀, γ, δᵩ, CFL)


timesolve!(sphprob; batch = 10, timeframe = 1.0, writetime = 0.02, path = &quot;D:/vtk/&quot;, pvc = true)</code></pre><div class="admonition is-success"><header class="admonition-header">Save results</header><div class="admonition-body"><p>If you want so save results define <code>path</code> and set <code>writetime</code>; <code>pvc = true</code> make pvd file. To make animation output try <code>anim = true</code>.</p></div></div><p>Other examples available <a href="https://github.com/PharmCat/GPUCellListSPH.jl/tree/main/examples">here</a>.</p><h2 id="Principle-algorithm"><a class="docs-heading-anchor" href="#Principle-algorithm">Principle algorithm</a><a id="Principle-algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Principle-algorithm" title="Permalink"></a></h2><p>This part of <code>stepsolve!</code> shows how main quations aplied.</p><pre><code class="language-julia hljs">        # kernels for each pair
        W_2d!(prob.W, pairs, x, prob.H⁻¹, prob.sphkernel)
        # kernels gradientfor each pair
        ∇W_2d!(prob.∇W, pairs, x, prob.H⁻¹, prob.sphkernel)
        # density derivative with density diffusion
        ∂ρ∂tDDT!(prob.∑∂ρ∂t, pairs, prob.∇W, prob.ρ, prob.v, x, prob.h, prob.m₀, prob.ρ₀, prob.c₀, prob.γ, prob.g, prob.δᵩ, prob.ptype; minthreads = 256) 
        #  pressure
        pressure!(prob.P, prob.ρ, prob.c₀, prob.γ, prob.ρ₀, prob.ptype) 
        # momentum equation 
        ∂v∂t!(prob.∑∂v∂t,  prob.∇W, prob.P, pairs,  prob.m₀, prob.ρ, prob.ptype) 
        # add artificial viscosity
        ∂v∂t_av!(prob.∑∂v∂t, prob.∇W, pairs, x, prob.h, prob.ρ, prob.α, prob.v, prob.c₀, prob.m₀, prob.ptype)
        # laminar shear stresse
        if prob.𝜈 &gt; 0
            ∂v∂t_visc!(prob.∑∂v∂t, prob.∇W, prob.v, prob.ρ, x, pairs, prob.h, prob.m₀, prob.𝜈, prob.ptype)
        end
        # add gravity 
        ∂v∂t_addgrav!(prob.∑∂v∂t, gravvec(prob.g, prob.dim)) 
        #  Boundary forces
        fbmolforce!(prob.∑∂v∂t, pairs, x, 0.4, 2 * prob.dx, prob.ptype)
        # add surface tension if s &gt; 0
        if prob.s &gt; 0
            ∂v∂tpF!(prob.∑∂v∂t, pairs, x, prob.s, prob.h, prob.m₀, prob.ptype) 
        end
        # following steps (update_ρ!, update_vp∂v∂tΔt!, update_xpvΔt!) can be done in one kernel 
        # calc ρ at Δt½
        update_ρp∂ρ∂tΔt!(prob.ρΔt½, prob.∑∂ρ∂t, prob.Δt * 0.5, prob.ρ₀, prob.ptype)
        # calc v at Δt½
        update_vp∂v∂tΔt!(prob.vΔt½, prob.∑∂v∂t, prob.Δt * 0.5, prob.ptype) 
        # calc x at Δt½
        update_xpvΔt!(prob.xΔt½, prob.vΔt½, prob.Δt * 0.5)</code></pre><h2 id="Docs"><a class="docs-heading-anchor" href="#Docs">Docs</a><a id="Docs-1"></a><a class="docs-heading-anchor-permalink" href="#Docs" title="Permalink"></a></h2><h3 id="Cell-list"><a class="docs-heading-anchor" href="#Cell-list">Cell list</a><a id="Cell-list-1"></a><a class="docs-heading-anchor-permalink" href="#Cell-list" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.GPUCellList" href="#GPUCellListSPH.GPUCellList"><code>GPUCellListSPH.GPUCellList</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">GPUCellList(points, cellsize, dist; mppcell = 0, mpairs = 0)</code></pre><p>Make cell list structure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/celllist.jl#L17-L21">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.update!" href="#GPUCellListSPH.update!"><code>GPUCellListSPH.update!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update!(c::GPUCellList)</code></pre><p>Full update cell grid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/celllist.jl#L98-L102">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.partialupdate!" href="#GPUCellListSPH.partialupdate!"><code>GPUCellListSPH.partialupdate!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">partialupdate!(c::GPUCellList, fillzero::Bool = true)</code></pre><p>Update only distance </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/celllist.jl#L155-L159">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.neighborlist" href="#GPUCellListSPH.neighborlist"><code>GPUCellListSPH.neighborlist</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">neighborlist(c::GPUCellList)</code></pre><p>List of pairs with distance.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/celllist.jl#L171-L175">source</a></section></article><h3 id="SPH-problem-object"><a class="docs-heading-anchor" href="#SPH-problem-object">SPH problem object</a><a id="SPH-problem-object-1"></a><a class="docs-heading-anchor-permalink" href="#SPH-problem-object" title="Permalink"></a></h3><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>GPUCellListSPH.SPHProblem</code>. Check Documenter&#39;s build log for details.</p></div></div><p>Object structure:</p><pre><code class="nohighlight hljs">    system::GPUCellList
    dim::Int
    dx::T
    h::T                                  # smoothing length
    h⁻¹::T
    H::T                                  # kernel support radius (2h)
    H⁻¹::T
    sphkernel::AbstractSPHKernel          # SPH kernel from SPHKernels.jl
    ∑W::CuArray                           # sum of kernel values
    ∑∇W                                   # sum of kernel gradients
    W::CuArray                            # values of kernel gradient for each pair 
    ∇W::CuArray                           # values of kernel gradient for each pair 
    ∑∂v∂t                                 # acceleration (momentum equation)
    ∑∂ρ∂t                                 # rho diffusion - density derivative function (with diffusion)
    ρ::CuArray                            # rho
    ρΔt½::CuArray                         # rho at t½  
    v::CuArray                            # velocity
    vΔt½::CuArray                         # velocity at t½  
    xΔt½::CuArray                         # coordinates at xΔt½
    P::CuArray                            # pressure (Equation of State in Weakly-Compressible SPH)
    ptype::CuArray                        # particle type: 1 - fluid 1; 0 - boundary; -1 boundary hard layer 
    ρ₀::T                                 # Reference density
    m₀::T                                 # Initial mass
    Δt::T                                 # default Δt
    α::T                                  # Artificial viscosity alpha constant
    𝜈::T                                  # kinematic fluid viscosity
    g::T                                  # gravity constant
    c₀::T                                 # speed of sound
    γ                                     # Gamma, 7 for water (used in the pressure equation of state)
    s::T                                  # surface tension constant
    δᵩ::T                                 # Coefficient for density diffusion, typically 0.1
    CFL::T                                # CFL number for the simulation 
    buf::CuArray                          # buffer for dt calculation
    buf2                                  # buffer 
    etime::T                              # simulation time
    cΔx                                   # cumulative location changes in batch
    nui::T                                # non update interval, update if maximum(maximum.(abs, prob.cΔx)) &gt; 0.9 * prob.nui  
    # Dynamic Particle Collision (DPC) 
    dpc_l₀::T                             # minimal distance
    dpc_pmin::T                           # minimal pressure
    dpc_pmax::T                           # maximum pressure
    dpc_λ::T                              # λ is a non-dimensional adjusting parameter
    # XSPH
    xsph_𝜀::T                             # xsph constant</code></pre><h3 id="Processing-functions"><a class="docs-heading-anchor" href="#Processing-functions">Processing functions</a><a id="Processing-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Processing-functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.stepsolve!" href="#GPUCellListSPH.stepsolve!"><code>GPUCellListSPH.stepsolve!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">stepsolve!(prob::SPHProblem, n::Int = 1; timecall = nothing, timestepping = false, timelims = (-Inf, +Inf))</code></pre><p>Make <code>n</code> itarations. </p><p>timestepping - call Δt_stepping for adjust Δt</p><p>timelims - minimal and maximum values for Δt</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/sphproblem.jl#L174-L182">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.timesolve!" href="#GPUCellListSPH.timesolve!"><code>GPUCellListSPH.timesolve!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">timesolve!(prob::SPHProblem; batch = 10, 
timeframe = 1.0, 
writetime = 0, 
path = nothing, 
pvc = false, 
vtkvars = [&quot;Acceleration&quot;, &quot;Velocity&quot;, &quot;Pressure&quot;],
timestepping = false, 
timelims = (-Inf, +Inf), 
anim = false,
plotsettings = Dict(:leg =&gt; false))</code></pre><p>Make simulation by <code>batch</code> iterations within <code>timeframe</code>. </p><p>writetime - time interval for write vtk / animation.</p><p>path - path to export directory.</p><p>pvc - make PVD file.</p><p>vtkvars - variables for export, full list:  <code>[&quot;Acceleration&quot;, &quot;Velocity&quot;, &quot;Pressure&quot;, &quot;Density&quot;, &quot;∑W&quot;, &quot;∑∇W&quot;, &quot;DPC&quot;]</code> </p><p>anim - make animation.</p><p>showframe - show animation each frame.</p><p>plotsettings - keywords for plotting.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/sphproblem.jl#L371-L398">source</a></section></article><h3 id="Main-equations"><a class="docs-heading-anchor" href="#Main-equations">Main equations</a><a id="Main-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Main-equations" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∑W_2d!" href="#GPUCellListSPH.∑W_2d!"><code>GPUCellListSPH.∑W_2d!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∑W_2d!(∑W, pairs, sphkernel, H⁻¹)</code></pre><p>Compute sum of kernel values for each particles pair in list. Add to <code>∑W</code>. See SPHKernels.jl for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L363-L368">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∑∇W_2d!" href="#GPUCellListSPH.∑∇W_2d!"><code>GPUCellListSPH.∑∇W_2d!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∑∇W_2d!(∑∇W, ∇W, pairs, points, kernel, H⁻¹)</code></pre><p>Compute gradients. Add sum to <code>∑∇W</code> and update <code>∇W</code>. See SPHKernels.jl for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L431-L437">source</a></section><section><div><pre><code class="language-julia hljs">∑∇W_2d!(∑∇W, pairs, points, kernel, H⁻¹)</code></pre><p>Compute gradients. Add sum to ∑∇W. See SPHKernels.jl for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L476-L482">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∂ρ∂tDDT!" href="#GPUCellListSPH.∂ρ∂tDDT!"><code>GPUCellListSPH.∂ρ∂tDDT!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∂ρ∂tDDT!(∑∂ρ∂t,  ∇W, pairs, points, h, m₀, δᵩ, c₀, γ, g, ρ₀, ρ, v, ptype)</code></pre><p>Compute ∂ρ∂t - density derivative includind density diffusion. <em>Replace all values and update <code>∑∂ρ∂t</code>.</em></p><p class="math-container">\[
\frac{\partial \rho_i}{\partial t} = \sum  m_j \textbf{v}_{ij} \cdot \nabla_i W_{ij} + \delta_{\Phi} h c_0 \sum \Psi_{ij} \cdot \nabla_i W_{ij} \frac{m_j}{\rho_j}

\\

\Psi_{ij} = 2 (\rho_{ij}^T - \rho_{ij}^H) \frac{\textbf{r}_{ij}}{r_{ij}^2 + \eta^2}

\\

\rho_{ij}^H = \rho_0 \left( \sqrt[\gamma]{\frac{P_{ij}^H + 1}{C_b}} - 1\right)

\\

P_{ij}^H = \rho_0 g z_{ij}
\]</p><p><span>$z_{ij}$</span> - vertical distance.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L537-L563">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.pressure!" href="#GPUCellListSPH.pressure!"><code>GPUCellListSPH.pressure!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pressure!(P, ρ, c₀, γ, ρ₀, ptype)</code></pre><p>Equation of State in Weakly-Compressible SPH.</p><p class="math-container">\[P = c_0^2 \rho_0 * \left[  \left( \frac{\rho}{\rho_0} \right)^{\gamma}  \right]\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L698-L707">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∂v∂t!" href="#GPUCellListSPH.∂v∂t!"><code>GPUCellListSPH.∂v∂t!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∂v∂t!(∑∂v∂t,  ∇W, pairs, m₀, ρ, c₀, γ, ρ₀)</code></pre><p>The momentum equation (without dissipation and gravity). <em>Add to <code>∑∂v∂t</code>.</em></p><p class="math-container">\[\frac{\partial \textbf{v}_i}{\partial t} = - \sum  m_j \left( \frac{p_i}{\rho^2_i} + \frac{p_j}{\rho^2_j} \right) \nabla_i W_{ij}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L727-L737">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∂v∂t_av!" href="#GPUCellListSPH.∂v∂t_av!"><code>GPUCellListSPH.∂v∂t_av!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∂v∂t_av!(∑∂v∂t, ∇W, pairs, points, h, ρ, α, v, c₀, m₀)</code></pre><p>Compute artificial viscosity part of ∂v∂t. <em>Add to <code>∑∂v∂t</code>.</em></p><p class="math-container">\[\Pi_{ij} = \begin{cases} \frac{- \alpha \overline{c}_{ij} \mu_{ij} + \beta \mu_{ij}^2 }{\overline{\rho}_{ij}} &amp;  \textbf{v}_{ij} \cdot \textbf{r}_{ij} &lt; 0 \\ 0 &amp;  otherwise \end{cases}\]</p><p class="math-container">\[\mu_{ij} = \frac{h \textbf{v}_{ij}\cdot \textbf{r}_{ij}}{r_{ij}^2 + \eta^2}\]</p><p class="math-container">\[\overline{c}_{ij}  = \frac{c_i + c_j}{2}\]</p><p class="math-container">\[\overline{\rho}_{ij} = \frac{\rho_i + \rho_j}{2}\]</p><p class="math-container">\[\beta = 0

\c_{ij} = c_0

\m_i = m_j = m_0
\]</p><p>Artificial viscosity part of momentum equation. </p><p class="math-container">\[\frac{\partial \textbf{v}_i}{\partial t} = - \sum  m_j \Pi_{ij} \nabla_i W_{ij}\]</p><p>J. Monaghan, Smoothed Particle Hydrodynamics, “Annual Review of Astronomy and Astrophysics”, 30 (1992), pp. 543-574.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L771-L811">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∂v∂t_visc!" href="#GPUCellListSPH.∂v∂t_visc!"><code>GPUCellListSPH.∂v∂t_visc!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∂v∂t_visc!(∑∂v∂t,  ∇W, pairs, m, ρ, c₀, γ, ρ₀)</code></pre><p>Compute laminar shear stresse part of ∂v∂t. <em>Add to <code>∑∂v∂t</code>.</em></p><p class="math-container">\[\frac{\partial \textbf{v}_i}{\partial t} = \sum \frac{m_j}{\rho_j}  \left( 2 \nu_i \frac{\textbf{r}_{ij} \cdot \nabla_i W_{ij} }{r_{ij}^2} \right) \textbf{v}_{ij}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L872-L881">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∂v∂t_addgrav!" href="#GPUCellListSPH.∂v∂t_addgrav!"><code>GPUCellListSPH.∂v∂t_addgrav!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∂v∂t_addgrav!(∑∂v∂t, gvec)</code></pre><p>Add gravity to the momentum equation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L921-L926">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.∂v∂tpF!" href="#GPUCellListSPH.∂v∂tpF!"><code>GPUCellListSPH.∂v∂tpF!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">∂v∂tpF!(∑∂v∂t, pairs, points, s, H)</code></pre><p>Add surface tension to ∑∂v∂t. Modified.</p><p>A. Tartakovsky and P. Meakin, Phys. Rev. E 72 (2005)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L1174-L1181">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.dpcreg!" href="#GPUCellListSPH.dpcreg!"><code>GPUCellListSPH.dpcreg!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">dpcreg!(∑Δvdpc, v, ρ, P, pairs, points, sphkernel, l₀, Pmin, Pmax, Δt, λ, dpckernlim)</code></pre><p>Dynamic Particle Collision (DPC) correction. <em>Replace all values and update <code>∑Δvdpc</code>.</em></p><p class="math-container">\[\delta \textbf{v}_i^{DPC} = \sum k_{ij}\frac{m_j}{m_i + m_j}v_{ij}^{coll} + \frac{\Delta  t}{\rho_i}\sum \phi_{ij} \frac{2V_j}{V_i + V_j}\frac{p_{ij}^b}{r_{ij}^2 + \eta^2}\textbf{r}_{ij}

\\

(v_{ij}^{coll} , \quad \phi_{ij}) = \begin{cases} (\frac{\textbf{v}_{ij}\cdot \textbf{r}_{ij}}{r_{ij}^2 + \eta^2}\textbf{r}_{ji}, \quad 0) &amp; \textbf{v}_{ij}\cdot \textbf{r}_{ij} &lt; 0 \\ (0, \quad 1) &amp;  otherwise \end{cases}

\\
p_{ij}^b = \tilde{p}_{ij} \chi_{ij} 

\\

\tilde{p}_{ij} = max(min(\lambda |p_i + p_j|, \lambda p_{max}), p_{min})

\\

\chi_{ij}  = \sqrt{\frac{\omega({r}_{ij}, l_0)}{\omega(l_0/2, l_0)}}

\\

k_{ij} =  \begin{cases} \chi_{ij} &amp; 0.5 \le {r}_{ij}/l_0 &lt; 1 \\ 1 &amp; {r}_{ij}/l_0 &lt; 0.5 \end{cases}
\]</p><p>Mojtaba Jandaghian, Herman Musumari Siaben, Ahmad Shakibaeinia, Stability and accuracy of the weakly compressible SPH with particle regularization techniques https://arxiv.org/pdf/2110.10076.pdf</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L1223-L1256">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.cspmcorr!" href="#GPUCellListSPH.cspmcorr!"><code>GPUCellListSPH.cspmcorr!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cspmcorr!(∑ρcspm1, ∑ρcspm2, ρ, m₀, pairs, points, sphkernel, H⁻¹)</code></pre><p>Corrected Smoothed Particle Method (CSPM) Density Renormalisation.</p><p class="math-container">\[
\rho_{i}^{norm} = \frac{\sum m_j W}{\sum \frac{m_j}{\rho_j} W}\]</p><p>Chen JK, Beraun JE, Carney TC (1999) A corrective smoothed particle method for boundary value problems in heat conduction. Int. J. Num. Meth. Engng. https://doi.org/10.1002/(SICI)1097-0207(19990920)46:2&lt;231::AID-NME672&gt;3.0.CO;2-K</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L1362-L1374">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.xsphcorr!" href="#GPUCellListSPH.xsphcorr!"><code>GPUCellListSPH.xsphcorr!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">xsphcorr!(∑Δvxsph, v, ρ, W, pairs, m₀)</code></pre><p>The XSPH correction.</p><p class="math-container">\[
\hat{\textbf{v}_{i}} = - \epsilon \sum m_j \frac{\textbf{v}_{ij}}{\overline{\rho}_{ij}} W_{ij}
\]</p><ul><li><p>Monaghan JJ (1989) On the problem of penetration in particle methods. J Comput Phys. https://doi.org/10.1016/0021-9991(89)90032-6</p></li><li><p>Carlos Alberto Dutra Fraga Filho, Reflective Boundary Conditions Coupled With the SPH Method for the Three-Dimensional Simulation of Fluid-Structure Interaction With Solid Boundaries</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L1425-L1440">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.fbmolforce!" href="#GPUCellListSPH.fbmolforce!"><code>GPUCellListSPH.fbmolforce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">fbmolforce!(∑∂v∂t, pairs, points, d, r₀, ptype)</code></pre><p>The repulsive force exerted by the virtual particle on the fluid particle.</p><p class="math-container">\[F = D * \frac{\left( (\frac{r_0}{\textbf{r}_{ij}})^{n_1} - (\frac{r_0}{\textbf{r}_{ij}})^{n_2}\right)}{r_{ij}^2}\]</p><ul><li>Rapaport, 2004</li></ul><p>n₁ = 12</p><p>n₂ = 4</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/gpukernels2d.jl#L1506-L1520">source</a></section></article><h3 id="Export-functions"><a class="docs-heading-anchor" href="#Export-functions">Export functions</a><a id="Export-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Export-functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.makedf" href="#GPUCellListSPH.makedf"><code>GPUCellListSPH.makedf</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">makedf(prob::SPHProblem; vtkvars = [&quot;Density&quot;, &quot;Acceleration&quot;, &quot;Velocity&quot;])</code></pre><p>Make DataFrame from SPH Problem.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/auxillary.jl#L13-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="GPUCellListSPH.writecsv" href="#GPUCellListSPH.writecsv"><code>GPUCellListSPH.writecsv</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">writecsv(prob::SPHProblem, path; vtkvars = [&quot;Density&quot;, &quot;Acceleration&quot;, &quot;Velocity&quot;])</code></pre><p>write CSV file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PharmCat/GPUCellListSPH.jl/blob/7d4fcebaddd614a9d4e0a3b623db6bbbe3441cbd/src/auxillary.jl#L61-L65">source</a></section></article><h2 id="Reference"><a class="docs-heading-anchor" href="#Reference">Reference</a><a id="Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Reference" title="Permalink"></a></h2><ul><li><p>R.A. Gingold; J.J. Monaghan (1977). &quot;Smoothed particle hydrodynamics: theory and application to non-spherical stars&quot;. Mon. Not. R. Astron. Soc. 181 (3): 375–89. Bibcode:1977MNRAS.181..375G. doi:10.1093/mnras/181.3.375.</p></li><li><p>L.B. Lucy (1977). &quot;A numerical approach to the testing of the fission hypothesis&quot;. Astron. J. 82: 1013–1024. Bibcode:1977AJ.....82.1013L. doi:10.1086/112164.</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="details/">Details »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 2 March 2024 15:39">Saturday 2 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
